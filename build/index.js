(()=>{"use strict";const e=window.wp.plugins,t=window.React,s=window.wp.components,o=window.wp.i18n,n=window.wp.data,i=window.wp.editor,p=window.wp.element,r=window.wp.url,a=window.wp.compose,l={META_ENABLED:"_sppp_enabled",META_KEY:"_sppp_key",QUERY_PARAM:"_sppp_key"},{META_KEY:d,QUERY_PARAM:c}=l,w=({text:e,onCopy:o,children:n,...i})=>{const p=(0,a.useCopyToClipboard)(e,o);return(0,t.createElement)(s.Button,{variant:"secondary",ref:p,...i},n)};class u extends p.Component{constructor(){super(...arguments),this.state={showCopyConfirmation:!1},this.onCopy=this.onCopy.bind(this),this.onSelectInput=this.onSelectInput.bind(this)}componentWillUnmount(){clearTimeout(this.dismissCopyConfirmation)}onCopy(){this.setState({showCopyConfirmation:!0}),clearTimeout(this.dismissCopyConfirmation),this.dismissCopyConfirmation=setTimeout((()=>{this.setState({showCopyConfirmation:!1})}),4e3)}onSelectInput(e){e.target.select()}render(){const e=(0,r.addQueryArgs)(this.props.postLink,{[c]:this.props.secretKey});return(0,t.createElement)("div",null,(0,t.createElement)("label",{htmlFor:"sppp-link-field",className:"screen-reader-text"},(0,o.__)("Share this URL","sharable-password-protected-posts")),(0,t.createElement)(s.Flex,{className:"sppp__link-copy"},(0,t.createElement)(s.TextControl,{id:"sppp-link-field",className:"sppp__link-field",readOnly:!0,label:(0,o.__)("Secret URL:","sharable-password-protected-posts"),value:(0,r.safeDecodeURIComponent)(e),onFocus:this.onSelectInput}),(0,t.createElement)(w,{text:e,onCopy:this.onCopy,className:"sppp__copy-button"},this.state.showCopyConfirmation?(0,o.__)("Copied!","sharable-password-protected-posts"):(0,o.__)("Copy","sharable-password-protected-posts"))))}}const m=(0,n.withSelect)((e=>{const{getEditedPostAttribute:t,getPermalink:s}=e(i.store);return{postLink:s(),secretKey:t("meta")[d]}}))(u),h=window.wp.coreData,y=({children:e})=>{const{isPostTypeVisible:t,postType:s,isPostPrivate:o}=(0,n.useSelect)((e=>{let t=!1;const s=e(i.store).getCurrentPostType(),o=e(h.store).getPostType(s),n=e(i.store).getEditedPostAttribute("link"),p=e(i.store).getEditedPostVisibility();return o?.viewable&&(t=!0),n&&(t=!0),e(i.store).getPermalinkParts()&&(t=!0),{isPostTypeVisible:t,postType:s,isPostPrivate:"private"===p||"password"===p}}),[]),p=window.sppp&&window.sppp.settings.postTypes.includes(s);return window.sppp&&window.sppp.settings.hasPermissions&&t&&p&&o?e:null};var _,E;const C=null!==(_=wp.editor?.PluginPostStatusInfo)&&void 0!==_?_:null!==(E=wp.editPost?.PluginPostStatusInfo)&&void 0!==E?E:wp.editSite?.PluginPostStatusInfo,{META_ENABLED:P,META_KEY:b}=l;(0,e.registerPlugin)("sharable-password-protected-posts",{render:()=>{const{sharingEnabled:e,existingKey:p}=(0,n.useSelect)((e=>{const{getEditedPostAttribute:t}=e(i.store),s=t("meta");return{sharingEnabled:s?.[P]||null,existingKey:s?.[b]||null}})),{editPost:r}=(0,n.useDispatch)(i.store);return(0,t.createElement)(C,{className:"sppp"},(0,t.createElement)(y,null,(0,t.createElement)("div",{className:"sppp__checkbox"},(0,t.createElement)(s.CheckboxControl,{label:(0,o.__)("Share post via secret URL","sharable-password-protected-posts"),checked:!!e,onChange:e=>{r(e?{meta:{[P]:!0,[b]:p||window.sppp.newKey||""}}:{meta:{[P]:!1,[b]:""}})}})),e&&(0,t.createElement)("div",{className:"sppp__link"},(0,t.createElement)(m,null))))}})})();